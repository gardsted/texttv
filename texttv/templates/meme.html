<html>
<head>
<meta charset=utf-8>
</head>
<style>
div#fan{
    width:500px; 
    height:500px;
    background-image: url("/static/macron.png");
}
</style>
<body>
<div id=fan xmlns="http://www.w3.org/1999/xhtml">
</div>


<script>
function toimg(element){
    const targetImg = document.createElement('img')
    const style = document.getElementsByTagName("style")[0].outerHTML
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d')
    canvas.width = element.clientWidth
    canvas.height = element.clientHeight
    const tempImg = document.createElement('img')
    tempImg.addEventListener('load', onTempImageLoad)
    var tempsrc= '<svg xmlns="http://www.w3.org/2000/svg" width="'+ 
        canvas.width+'" height="' + 
        canvas.height + '">' + style + '<foreignObject width="100%" height="100%">' + 
        element.outerHTML + '</foreignObject></svg>'
    console.log(tempsrc)
    tempImg.src = 'data:image/svg+xml,' + encodeURIComponent(tempsrc)

    document.body.appendChild(targetImg)

    function onTempImageLoad(e){
        ctx.drawImage(e.target, 0, 0)
        targetImg.src = canvas.toDataURL()
    }    
}

var elements = [...document.getElementsByTagName("div")]
elements.forEach( element => {
    toimg(element)
    document.body.removeChild(element)
})

</script>
</body>
</html>


