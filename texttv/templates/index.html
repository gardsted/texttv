<html>
<head>
<meta charset=utf-8>
<style>
body  {
    color: #dddddd;
    background-color: black;
    font-family: "Lucida Console", Monaco, monospace;
}

table{
    font-family: "Lucida Console", Monaco, monospace;
    background-color: #111e3f;
    color: #dddddd;
    border: none;
    padding: 10px;
}
table th{
    font-weight: normal;
    width: {{width/2}}px;
    border: none;
}
table td{
	width: ${{width}}px;
    border: none;
}
table *{ 
    font-size:{{fontsize}}%;
    font-weight: bold; 
}
table h1,table h2,table h3,table h4,table h5{ 
    color: #e2e220; text-align: center; font-weight: bold; 
}
table *.r{text-align:right}
table *.l{text-align:left}
table p{word-break: break-word;}
input,textarea{width:100%; max-width:{{width}}px;}
textarea{min-height:{{width/2}}px; padding: 5px;}
input.top {width:100%; max-width:{{width}}px;}
input.top#right {text-align:right;}
</style>
</head>
<body>

<form method=GET>
<input type=submit name=done value="Download / Done"><br>
<input class=top name=left placeholder="13 char(max) left" value="{{left}}"><br>
<input class=top name=right id=right prefix placeholder="15 char(max) right" value="{{right}}"><br>
<textarea name=longtext placeholder="
Enter markdown

# this is a top heading, 

## this is a sub heading

<br> is a hard page break
">{{longtext}}
</textarea><br>
<input type=submit name=preview value="Preview"><br>
</form>

{% for t in rendered %}
<table border=0 id=ttvtable xmlns="http://www.w3.org/1999/xhtml">
	<tr><th class=l>{{t.left}}</th><th class=r>{{t.right}}</th></tr>
	<tr><td class=l colspan=2>{{t.html}}
<p></td></tr>
</table>
<p></p>
{% endfor %}

<script>
function toimg(element){
    const targetImg = document.createElement('img')
    const style = document.getElementsByTagName("style")[0].outerHTML
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d')
    canvas.width = element.clientWidth
    canvas.height = element.clientHeight
    const tempImg = document.createElement('img')
    tempImg.addEventListener('load', onTempImageLoad)
    var tempsrc= '<svg xmlns="http://www.w3.org/2000/svg" width="'+ 
        canvas.width+'" height="' + 
        canvas.height + '">' + style + '<foreignObject width="100%" height="100%">' + 
        element.outerHTML + '</foreignObject></svg>'
    console.log(tempsrc)
    tempImg.src = 'data:image/svg+xml,' + encodeURIComponent(tempsrc)

    document.body.appendChild(targetImg)

    function onTempImageLoad(e){
        ctx.drawImage(e.target, 0, 0)
        targetImg.src = canvas.toDataURL()
    }    
}

var tables = [...document.getElementsByTagName("table")]
tables.forEach( table => {
    toimg(table)
    document.body.removeChild(table)
})

</script>
</body>
</html>
